<!DOCTYPE html>
<html lang="en">
<head>
   <meta name="viewport" content="width=device-width" />
   <meta charset="UTF-8" />
   <title>Test</title>
</head>
<body>
   <div>
      <a href="https://alexcican.com/stagedoor/test?v=4&amp;fromBtnOpenApp=true">Test me (has solution)</a><br/>
      <a href="" class="open_in_app">Open in App</a>
   </div>


   <script
     src="https://code.jquery.com/jquery-3.3.1.slim.js"
     integrity="sha256-fNXJFIlca05BIO2Y5zh1xrShK3ME+/lYZ0j+ChxX2DA="
     crossorigin="anonymous"></script>

   <script>
    // split URL
    function getParameterByName(name, url) {
      name = name.replace(/[\[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    // detect if iPhone/iPad/iPod
    var notiOS = true;
    if((navigator.userAgent.match(/iPhone/i)) || (navigator.userAgent.match(/iPod/i)) || (navigator.userAgent.match(/iPad/i))) {
      notiOS = false;
    }

    // if on iOS device check to see if user has the app or not
    if (notiOS === false) {
      var url = window.location.href;
      // add the Open in App button
      // $('body').append('<a href="' + url + '&amp;fromBtnOpenApp=true" class="open-in-app">Open in App</a>');
      var urlNew = url + '&amp;fromBtnOpenApp=true';
      $('.open_in_app').attr("href", urlNew);
      // check if tapped
      var fromBtnOpenApp = getParameterByName('fromBtnOpenApp', url);
      if (fromBtnOpenApp === "true") {
        // if parameter exists means page was reloaded = user doesn't have the app. Show App Store alert
        window.location = "https://itunes.apple.com/gb/app/stagedoor-london-theatre-app/id963068912?ls=1&mt=8";
      }
    }
   </script>
</body>
</html>
